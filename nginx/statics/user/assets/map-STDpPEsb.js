import{j as e,u as h,p as x,r as i,q as g,b as f}from"./index-ktjJghY_.js";import{G as v,S as j}from"./iconBase-Dkw77_VP.js";import{c as N}from"./index-BV_IynQ4.js";import{C as b}from"./content-layout-DRKVCqtq.js";import{u as y,L as p}from"./use-qr-scanner-DVsDXS8U.js";import{u as w}from"./next-yaNlURKo.js";import"./api-client-CipG6Tld.js";const z="/user/assets/progress0-B-1bkrg3.svg",C="/user/assets/progress1-BfDBdIJo.svg",F="/user/assets/progress2-ju8DIlUm.svg",H="/user/assets/progress3-3QNCkEhF.svg",I={0:z,1:C,2:F,3:H},V=({progress:t=0})=>e.jsx("img",{src:I[t],alt:"進捗メーター"}),M={0:{description:""},1:{description:"1F"},2:{description:"2F"},3:{description:"3F"},4:{description:"4F"},5:{description:"5F"},6:{description:"6F"},7:{description:"7F"}},R=N("text-white text-3xl font-semibold text-center",{variants:{floor:{0:"bg-[#A3A3A333]",1:"bg-[#62454180]",2:"bg-[#63832D80]",3:"bg-[#2D838380]",4:"bg-[#2D838380]",5:"bg-[#833B2D80]",6:"bg-[#7A2D8380]",7:"bg-[#2D838380]"}},defaultVariants:{floor:0}}),S=({floor:t,className:r})=>{const c=M[t],o=h(),a=()=>{t!==0&&o(x.app.floor.getHref(),{state:{id:t}})};return e.jsx("tr",{onClick:a,className:`h-32 ${r}`,children:e.jsx("td",{className:R({floor:t}),children:c.description})})},D=({floor:t})=>{const r={};r[t]=!0;const c=Object.entries(r).sort(([o],[a])=>parseInt(a)-parseInt(o)).map(([o,a])=>{const l=parseInt(o);return e.jsx(S,{floor:a?l:0},l)});return e.jsx("table",{className:"m-auto w-[320px]",children:c})};function k(t){return v({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M9.5 6.5v3h-3v-3h3M11 5H5v6h6V5zm-1.5 9.5v3h-3v-3h3M11 13H5v6h6v-6zm6.5-6.5v3h-3v-3h3M19 5h-6v6h6V5zm-6 8h1.5v1.5H13V13zm1.5 1.5H16V16h-1.5v-1.5zM16 13h1.5v1.5H16V13zm-3 3h1.5v1.5H13V16zm1.5 1.5H16V19h-1.5v-1.5zM16 16h1.5v1.5H16V16zm1.5-1.5H19V16h-1.5v-1.5zm0 3H19V19h-1.5v-1.5zM22 7h-2V4h-3V2h5v5zm0 15v-5h-2v3h-3v2h5zM2 22h5v-2H4v-3H2v5zM2 2v5h2V4h3V2H2z"},child:[]}]})(t)}const E=({children:t,...r})=>e.jsx("button",{...r,className:"flex h-16 w-52 items-center justify-center rounded-2xl bg-gradient-to-b from-[#E9D169] to-[#9C6C4C]",children:e.jsxs("div",{className:"flex h-14 w-[200px] items-center justify-center space-x-2 rounded-xl bg-[#B9B9BA]",children:[e.jsx(k,{className:"text-5xl"}),e.jsx("p",{className:"text-xs font-bold",children:"QRコードを読み取る"})]})}),B=()=>{const t=h(),{videoRef:r,canvasRef:c,result:o,error:a}=y(),[l,d]=i.useState(!1),m=w({mutationConfig:{onSuccess:s=>{if(s!=null&&s.msg){const n=s.msg.NextNum;console.log(`NextNum: ${n}`)}else console.error("Response structure is incorrect or undefined")},onError:s=>{console.error("Error:",s)}}}),u=async s=>{try{d(!0);const n=await m.mutateAsync({data:{clear_floor:parseInt(s)}});console.log("response:",n.msg),t(x.app.getQr.getHref(),{replace:!0,state:n})}catch(n){console.error("Error processing QR code:",n)}finally{d(!1)}};return i.useEffect(()=>{o&&!l&&u(o)},[o,l]),e.jsxs("section",{className:"flex w-full flex-col items-center",children:[!o&&e.jsx("div",{className:"size-72",children:e.jsxs("div",{className:"relative h-72 w-72",children:[e.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,className:"absolute left-0 top-0 -z-50 h-72 w-72"}),e.jsx("canvas",{ref:c,width:"288",height:"288",className:"absolute left-0 top-0"})]})}),a&&e.jsx("p",{className:"text-center text-xs text-red-500",children:a}),!o&&!a&&e.jsx("div",{className:"absolute top-0 text-center text-gray-500",children:e.jsx(p,{})})]})},A=async t=>(console.log("postFloor"),await(await fetch(`${g.API_URL}/admin/game/floor`,{method:"POST",headers:{"Content-Type":"application/json",GameID:t}})).json()),U=()=>{const t=f(),[r,c]=i.useState(!1),[o,a]=i.useState(1),[l,d]=i.useState(!0),m=i.useCallback(()=>{try{const s=t.state;if(console.log("states-m:",s),console.log("state:",typeof s.msg.NextNum),s&&typeof s=="object"&&"msg"in s&&typeof s.msg=="object"&&"NextNum"in s.msg&&typeof s.msg.NextNum=="number"){const n=s.msg.NextNum;[1,2,5,6].includes(n)?a(n):console.error("Invalid floor value:",n)}else console.error("Invalid location.state structure:",s)}catch(s){console.error("Error fetching floor data:",s)}finally{d(!1)}},[t.state]);i.useEffect(()=>{m()},[]);const u=()=>{var s;A(((s=localStorage.getItem("token"))==null?void 0:s.toString())||"")};return e.jsx(b,{children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-12 pb-7 pt-20",children:[e.jsxs("div",{className:"text-center text-white",children:[e.jsx("p",{className:"",onClick:u,children:"経過時間"}),e.jsx("div",{className:"text-5xl",children:e.jsx(j,{})})]}),e.jsx(V,{progress:0})]}),l?e.jsx("div",{className:"absolute top-0 text-white",children:e.jsx(p,{})}):e.jsx(D,{floor:o}),e.jsx("div",{className:"mt-10 flex items-center justify-center",children:e.jsx(E,{onClick:()=>c(!0)})}),r&&e.jsx("div",{className:"absolute top-0 h-svh w-full bg-black",children:e.jsxs("div",{className:"relative flex h-full items-center justify-center",children:[e.jsx("button",{className:"absolute right-4 top-4 rounded-full bg-gray-700 px-4 py-2 text-white",onClick:()=>c(!1)}),e.jsx(B,{})]})})]})})};export{U as MapRoute};
